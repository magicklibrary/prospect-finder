<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>TLI Prospect Finder</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet" />
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg:       #060e1a;
    --bg2:      #0c1929;
    --bg3:      #0f2040;
    --border:   #1e3a5f;
    --text:     #cbd5e1;
    --muted:    #475569;
    --dim:      #334155;
    --white:    #f1f5f9;
    --amber:    #f59e0b;
    --green:    #059669;
    --blue:     #3b82f6;
    --purple:   #8b5cf6;
  }

  body {
    background: var(--bg);
    font-family: 'DM Sans', sans-serif;
    color: var(--text);
    min-height: 100vh;
  }

  /* â”€â”€â”€ Header â”€â”€â”€ */
  header {
    background: rgba(6,14,26,0.9);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--bg3);
    height: 56px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 28px;
    position: sticky;
    top: 0;
    z-index: 50;
  }
  .logo { display: flex; align-items: center; gap: 12px; }
  .logo-badge {
    width: 32px; height: 32px; border-radius: 8px;
    background: linear-gradient(135deg, #f59e0b, #3b5fe8);
    display: flex; align-items: center; justify-content: center;
    font-family: 'Syne', sans-serif; font-weight: 800; font-size: 11px; color: #fff;
  }
  .logo-name { font-family: 'Syne', sans-serif; font-weight: 700; font-size: 14px; color: var(--white); line-height: 1.2; }
  .logo-sub  { font-size: 11px; color: var(--dim); }

  /* â”€â”€â”€ Layout â”€â”€â”€ */
  main { max-width: 860px; margin: 0 auto; padding: 28px 20px; }

  .panel {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 24px 28px;
    margin-bottom: 20px;
  }

  .panel-label {
    font-family: 'Syne', sans-serif; font-size: 11px; font-weight: 700;
    text-transform: uppercase; letter-spacing: 0.1em; color: var(--muted);
    margin-bottom: 18px;
  }

  /* â”€â”€â”€ Steps â”€â”€â”€ */
  .step-row { display: flex; align-items: flex-start; gap: 16px; }
  .step-num {
    width: 28px; height: 28px; border-radius: 50%; flex-shrink: 0;
    background: linear-gradient(135deg, var(--amber), #d97706);
    display: flex; align-items: center; justify-content: center;
    font-family: 'Syne', sans-serif; font-weight: 800; font-size: 13px; color: #fff;
  }
  .step-num.done { background: linear-gradient(135deg, var(--green), #047857); }
  .step-body { flex: 1; }

  /* â”€â”€â”€ Form â”€â”€â”€ */
  .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1.5fr; gap: 14px; }

  label.field-label {
    display: block; font-size: 10px; color: var(--muted);
    text-transform: uppercase; letter-spacing: 0.09em;
    font-family: 'Syne', sans-serif; font-weight: 600; margin-bottom: 7px;
  }

  select, input[type="text"] {
    width: 100%;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px 12px;
    color: var(--white);
    font-size: 13px;
    font-family: 'DM Sans', sans-serif;
    appearance: none;
    outline: none;
    transition: border-color 0.15s;
  }
  select:focus, input[type="text"]:focus { border-color: var(--blue); }
  input[type="text"]::placeholder { color: var(--dim); }

  /* â”€â”€â”€ Buttons â”€â”€â”€ */
  .btn {
    display: inline-flex; align-items: center; gap: 8px;
    padding: 10px 20px; border-radius: 8px; border: none;
    font-family: 'Syne', sans-serif; font-weight: 700; font-size: 13px;
    cursor: pointer; transition: opacity 0.15s; white-space: nowrap;
  }
  .btn:disabled { opacity: 0.4; cursor: not-allowed; }
  .btn-amber  { background: linear-gradient(135deg, var(--amber), #d97706); color: #fff; }
  .btn-green  { background: linear-gradient(135deg, var(--green), #047857); color: #fff; }
  .btn-blue   { background: linear-gradient(135deg, var(--blue), #1d4ed8); color: #fff; }
  .btn-ghost  { background: transparent; border: 1px solid var(--border); color: var(--muted); }
  .btn-ghost:hover { color: var(--white); border-color: #2d5a8f; }

  /* â”€â”€â”€ Prompt box â”€â”€â”€ */
  .prompt-box {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 14px 16px;
    font-family: 'DM Sans', sans-serif;
    font-size: 12px;
    color: #94a3b8;
    line-height: 1.7;
    white-space: pre-wrap;
    max-height: 180px;
    overflow-y: auto;
    margin: 14px 0;
  }

  .copy-notice {
    display: inline-flex; align-items: center; gap: 6px;
    font-size: 12px; color: var(--green); font-weight: 600;
    opacity: 0; transition: opacity 0.3s;
  }
  .copy-notice.show { opacity: 1; }

  /* â”€â”€â”€ Paste area â”€â”€â”€ */
  textarea {
    width: 100%;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 14px 16px;
    color: var(--white);
    font-family: 'DM Sans', sans-serif;
    font-size: 12px;
    line-height: 1.6;
    resize: vertical;
    min-height: 120px;
    outline: none;
    transition: border-color 0.15s;
  }
  textarea:focus { border-color: var(--blue); }
  textarea::placeholder { color: var(--dim); }

  /* â”€â”€â”€ Company cards â”€â”€â”€ */
  .cards { display: flex; flex-direction: column; gap: 10px; }

  .card {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-left: 3px solid var(--amber);
    border-radius: 10px;
    padding: 16px 20px;
    cursor: pointer;
    opacity: 0;
    animation: fadeUp 0.35s ease forwards;
  }
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(12px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .card-top { display: flex; align-items: flex-start; justify-content: space-between; gap: 12px; }
  .card-name { font-family: 'Syne', sans-serif; font-weight: 700; font-size: 15px; color: var(--white); }
  .card-meta { margin-top: 4px; display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
  .card-loc  { font-size: 12px; color: var(--muted); }
  .card-ind  { font-size: 12px; color: var(--dim); }
  .card-spend { font-family: monospace; font-size: 13px; color: #34d399; font-weight: 600; text-align: right; flex-shrink: 0; }
  .card-spend-lbl { font-size: 11px; color: var(--muted); }

  .badge {
    display: inline-block; padding: 2px 8px; border-radius: 4px;
    font-size: 11px; font-weight: 700; font-family: monospace;
    letter-spacing: 0.04em;
  }
  .badge-ltl  { background: #3b82f622; color: #60a5fa; border: 1px solid #3b82f644; }
  .badge-ftl  { background: #10b98122; color: #34d399; border: 1px solid #10b98144; }
  .badge-both { background: #8b5cf622; color: #a78bfa; border: 1px solid #8b5cf644; }
  .badge-def  { background: #64748b22; color: #94a3b8; border: 1px solid #64748b44; }

  .card-bio {
    margin-top: 10px; font-size: 12px; color: #94a3b8; line-height: 1.65;
    display: -webkit-box; -webkit-line-clamp: 2;
    -webkit-box-orient: vertical; overflow: hidden;
  }
  .card-bio.open { display: block; }

  .card-detail {
    margin-top: 14px; padding-top: 14px;
    border-top: 1px solid var(--border);
    display: none; flex-direction: column; gap: 12px;
  }
  .card-detail.open { display: flex; }

  .detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px 24px; }
  .field-lbl { font-size: 10px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 3px; }
  .field-val { font-size: 12px; color: #cbd5e1; }
  .field-val a { color: #60a5fa; text-decoration: none; }
  .field-val a:hover { text-decoration: underline; }

  .contact-block {
    background: var(--bg);
    border-radius: 8px; padding: 10px 14px;
    display: flex; align-items: center; gap: 12px;
  }
  .contact-avatar {
    width: 36px; height: 36px; border-radius: 50%; flex-shrink: 0;
    background: linear-gradient(135deg, #1d4ed8, #7c3aed);
    display: flex; align-items: center; justify-content: center;
    font-size: 15px; font-weight: 700; color: #fff;
  }
  .contact-name  { font-size: 13px; font-weight: 600; color: var(--white); }
  .contact-title { font-size: 11px; color: var(--muted); }
  .contact-li    { font-size: 11px; color: #60a5fa; text-decoration: none; display: block; margin-top: 2px; }

  .why-box {
    background: #f59e0b0d; border: 1px solid #f59e0b33;
    border-radius: 8px; padding: 8px 12px;
    font-size: 11px; color: #94a3b8; line-height: 1.6;
  }
  .why-label { color: #fbbf24; font-weight: 700; }

  .card-toggle { margin-top: 8px; font-size: 11px; color: var(--dim); }

  /* â”€â”€â”€ Results header â”€â”€â”€ */
  .results-head { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }
  .results-count { font-family: 'Syne', sans-serif; font-weight: 700; font-size: 14px; color: var(--white); }
  .results-meta  { font-size: 12px; color: var(--muted); margin-left: 10px; }

  /* â”€â”€â”€ Export footer â”€â”€â”€ */
  .export-bar {
    display: flex; align-items: center; justify-content: space-between;
    background: var(--bg2); border: 1px solid var(--border);
    border-radius: 12px; padding: 18px 24px; margin-top: 18px;
  }
  .export-bar-title { font-family: 'Syne', sans-serif; font-weight: 700; color: var(--white); font-size: 14px; }
  .export-bar-sub   { font-size: 12px; color: var(--muted); margin-top: 2px; }

  /* â”€â”€â”€ Error â”€â”€â”€ */
  .error-box {
    background: #1a0a0a; border: 1px solid #7f1d1d;
    border-radius: 10px; padding: 12px 16px;
    color: #fca5a5; font-size: 13px; margin-bottom: 18px;
  }

  /* â”€â”€â”€ Empty state â”€â”€â”€ */
  .empty { text-align: center; padding: 80px 0; }
  .empty-icon { font-size: 52px; margin-bottom: 16px; }
  .empty-title { font-family: 'Syne', sans-serif; font-weight: 700; color: var(--border); font-size: 22px; margin-bottom: 10px; }
  .empty-sub   { color: var(--dim); font-size: 13px; line-height: 1.8; max-width: 400px; margin: 0 auto; }

  /* â”€â”€â”€ Divider â”€â”€â”€ */
  .divider { border: none; border-top: 1px solid var(--border); margin: 20px 0; }

  /* â”€â”€â”€ Scrollbar â”€â”€â”€ */
  ::-webkit-scrollbar { width: 5px; }
  ::-webkit-scrollbar-track { background: var(--bg); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

  /* â”€â”€â”€ Instruction highlight â”€â”€â”€ */
  .instr {
    background: var(--bg3);
    border-radius: 8px; padding: 10px 14px;
    font-size: 12px; color: #94a3b8; line-height: 1.7;
    margin-top: 12px;
  }
  .instr strong { color: var(--white); }

  @media (max-width: 640px) {
    .grid-3 { grid-template-columns: 1fr; }
    .export-bar { flex-direction: column; gap: 14px; align-items: flex-start; }
    header { padding: 0 16px; }
    main { padding: 20px 14px; }
    .panel { padding: 18px 16px; }
  }
</style>
</head>
<body>

<header>
  <div class="logo">
    <div class="logo-badge">TLI</div>
    <div>
      <div class="logo-name">Prospect Finder</div>
      <div class="logo-sub">Manufacturing &amp; Distribution Leads</div>
    </div>
  </div>
  <button class="btn btn-green" id="exportBtn" style="display:none" onclick="exportExcel()">
    â†“ Export to Excel
  </button>
</header>

<main>

  <!-- â•â•â• STEP 1: Search inputs â•â•â• -->
  <div class="panel">
    <div class="step-row">
      <div class="step-num" id="step1num">1</div>
      <div class="step-body">
        <div class="panel-label" style="margin-bottom:14px">Choose your territory</div>
        <div class="grid-3">
          <div>
            <label class="field-label">State</label>
            <select id="stateSelect" onchange="onStateChange()">
              <option value="">Select stateâ€¦</option>
              <option value="AL">AL â€” Alabama</option><option value="AK">AK â€” Alaska</option>
              <option value="AZ">AZ â€” Arizona</option><option value="AR">AR â€” Arkansas</option>
              <option value="CA">CA â€” California</option><option value="CO">CO â€” Colorado</option>
              <option value="CT">CT â€” Connecticut</option><option value="DE">DE â€” Delaware</option>
              <option value="FL">FL â€” Florida</option><option value="GA">GA â€” Georgia</option>
              <option value="HI">HI â€” Hawaii</option><option value="ID">ID â€” Idaho</option>
              <option value="IL">IL â€” Illinois</option><option value="IN">IN â€” Indiana</option>
              <option value="IA">IA â€” Iowa</option><option value="KS">KS â€” Kansas</option>
              <option value="KY">KY â€” Kentucky</option><option value="LA">LA â€” Louisiana</option>
              <option value="ME">ME â€” Maine</option><option value="MD">MD â€” Maryland</option>
              <option value="MA">MA â€” Massachusetts</option><option value="MI">MI â€” Michigan</option>
              <option value="MN">MN â€” Minnesota</option><option value="MS">MS â€” Mississippi</option>
              <option value="MO">MO â€” Missouri</option><option value="MT">MT â€” Montana</option>
              <option value="NE">NE â€” Nebraska</option><option value="NV">NV â€” Nevada</option>
              <option value="NH">NH â€” New Hampshire</option><option value="NJ">NJ â€” New Jersey</option>
              <option value="NM">NM â€” New Mexico</option><option value="NY">NY â€” New York</option>
              <option value="NC">NC â€” North Carolina</option><option value="ND">ND â€” North Dakota</option>
              <option value="OH">OH â€” Ohio</option><option value="OK">OK â€” Oklahoma</option>
              <option value="OR">OR â€” Oregon</option><option value="PA">PA â€” Pennsylvania</option>
              <option value="RI">RI â€” Rhode Island</option><option value="SC">SC â€” South Carolina</option>
              <option value="SD">SD â€” South Dakota</option><option value="TN">TN â€” Tennessee</option>
              <option value="TX">TX â€” Texas</option><option value="UT">UT â€” Utah</option>
              <option value="VT">VT â€” Vermont</option><option value="VA">VA â€” Virginia</option>
              <option value="WA">WA â€” Washington</option><option value="WV">WV â€” West Virginia</option>
              <option value="WI">WI â€” Wisconsin</option><option value="WY">WY â€” Wyoming</option>
            </select>
          </div>
          <div>
            <label class="field-label">ZIP Code <span style="color:var(--dim);font-size:9px;font-family:'DM Sans'">(nearby search)</span></label>
            <input type="text" id="zipInput" placeholder="e.g. 19101" maxlength="5" oninput="onZipInput()" />
          </div>
          <div>
            <label class="field-label">Industry Filter</label>
            <select id="industrySelect">
              <option value="">Any Industry</option>
              <option>Food &amp; Beverage Manufacturing</option>
              <option>Industrial / Heavy Manufacturing</option>
              <option>Building Materials</option>
              <option>Chemical Manufacturing</option>
              <option>Medical Device / Pharmaceutical</option>
              <option>Consumer Goods</option>
              <option>Automotive Parts</option>
              <option>Electronics Manufacturing</option>
              <option>Agricultural Products</option>
              <option>Plastics &amp; Rubber</option>
              <option>Metal Fabrication</option>
              <option>Paper &amp; Packaging</option>
              <option>Textiles</option>
              <option>Distribution (General)</option>
            </select>
          </div>
        </div>
        <p style="margin-top:12px;font-size:11px;color:var(--dim);">
          Returns 5â€“8 real manufacturers &amp; distributors ($30Mâ€“$150M revenue). No trucking or 3PL companies.
        </p>
      </div>
    </div>
  </div>

  <!-- â•â•â• STEP 2: Generate prompt â•â•â• -->
  <div class="panel">
    <div class="step-row">
      <div class="step-num" id="step2num">2</div>
      <div class="step-body">
        <div class="panel-label" style="margin-bottom:4px">Generate your search prompt</div>
        <p style="font-size:12px;color:var(--muted);margin-bottom:14px;">
          Click below to build a ready-to-paste prompt. Then open ChatGPT and paste it in.
        </p>

        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
          <button class="btn btn-amber" onclick="generatePrompt()">âš™ Build Prompt</button>
          <button class="btn btn-blue" id="openChatBtn" onclick="openChatGPT()" style="display:none">
            â†— Open ChatGPT
          </button>
          <button class="btn btn-ghost" id="copyBtn" onclick="copyPrompt()" style="display:none">
            â˜ Copy Prompt
          </button>
          <span class="copy-notice" id="copyNotice">âœ“ Copied!</span>
        </div>

        <div id="promptBox" class="prompt-box" style="display:none"></div>

        <div id="promptInstr" class="instr" style="display:none">
          <strong>Next steps:</strong> Click <strong>Open ChatGPT</strong> above â†’ paste the prompt â†’ wait for it to respond â†’
          copy <em>the entire response</em> â†’ come back here and paste it in Step 3.
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â• STEP 3: Paste results â•â•â• -->
  <div class="panel">
    <div class="step-row">
      <div class="step-num" id="step3num">3</div>
      <div class="step-body">
        <div class="panel-label" style="margin-bottom:4px">Paste ChatGPT's response</div>
        <p style="font-size:12px;color:var(--muted);margin-bottom:12px;">
          Copy the full response from ChatGPT and paste it here. Then click Load.
        </p>
        <textarea id="pasteArea" placeholder="Paste ChatGPT's response hereâ€¦"></textarea>
        <div style="display:flex;gap:10px;margin-top:12px;align-items:center;">
          <button class="btn btn-amber" onclick="loadResults()">â†“ Load Results</button>
          <button class="btn btn-ghost" onclick="clearAll()">âœ• Clear</button>
          <span id="parseError" style="font-size:12px;color:#fca5a5;display:none"></span>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â• Results â•â•â• -->
  <div id="resultsSection" style="display:none">
    <div class="results-head">
      <div>
        <span class="results-count" id="resultsCount">0 Prospects</span>
        <span class="results-meta" id="resultsMeta"></span>
      </div>
      <button class="btn btn-ghost" onclick="generatePrompt(); document.getElementById('pasteArea').focus();">
        â†» New Search
      </button>
    </div>
    <div class="cards" id="cardsContainer"></div>
    <div class="export-bar">
      <div>
        <div class="export-bar-title">Ready to work these leads?</div>
        <div class="export-bar-sub" id="exportSub"></div>
      </div>
      <button class="btn btn-green" onclick="exportExcel()">â†“ Download Excel</button>
    </div>
  </div>

  <!-- Empty state -->
  <div class="empty" id="emptyState">
    <div class="empty-icon">ğŸ­</div>
    <div class="empty-title">Find Your Next Freight Client</div>
    <div class="empty-sub">
      Pick a state or ZIP code, generate a prompt,<br>
      paste it into ChatGPT, then bring the results back here.<br><br>
      Free. No account. No API key.
    </div>
  </div>

</main>

<script>
// â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentPrompt = "";
let companies = [];
let lastSearch = {};

// â”€â”€â”€ Input handlers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function onStateChange() {
  if (document.getElementById("stateSelect").value) {
    document.getElementById("zipInput").value = "";
  }
}
function onZipInput() {
  const v = document.getElementById("zipInput").value.replace(/\D/g,"");
  document.getElementById("zipInput").value = v;
  if (v) document.getElementById("stateSelect").value = "";
}

// â”€â”€â”€ State name map â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const STATE_NAMES = {
  AL:"Alabama",AK:"Alaska",AZ:"Arizona",AR:"Arkansas",CA:"California",
  CO:"Colorado",CT:"Connecticut",DE:"Delaware",FL:"Florida",GA:"Georgia",
  HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",
  KY:"Kentucky",LA:"Louisiana",ME:"Maine",MD:"Maryland",MA:"Massachusetts",
  MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",
  NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",
  NY:"New York",NC:"North Carolina",ND:"North Dakota",OH:"Ohio",OK:"Oklahoma",
  OR:"Oregon",PA:"Pennsylvania",RI:"Rhode Island",SC:"South Carolina",
  SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",
  VA:"Virginia",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming"
};

// â”€â”€â”€ Build prompt â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function generatePrompt() {
  const state    = document.getElementById("stateSelect").value;
  const zip      = document.getElementById("zipInput").value.trim();
  const industry = document.getElementById("industrySelect").value;

  if (!state && !zip) {
    alert("Please select a state or enter a ZIP code first.");
    return;
  }

  let location = "";
  if (zip) location = `ZIP code ${zip} and within 25 miles`;
  else      location = `the state of ${STATE_NAMES[state] || state} (${state})`;

  const industryLine = industry
    ? `Focus specifically on the ${industry} sector.`
    : "Return a variety of industries â€” don't repeat the same type.";

  currentPrompt = `You are a B2B freight sales research assistant. Find 5â€“8 REAL mid-sized manufacturing or distribution companies located in ${location}.

${industryLine}

STRICT REQUIREMENTS:
- Revenue between $30M and $150M (freight spend roughly $125,000â€“$4,500,000/year)
- Must physically manufacture or distribute products
- EXCLUDE: trucking companies, freight brokers, 3PLs, logistics providers, warehousing-only â€” these are competitors
- Only real, verifiable companies with a physical U.S. address

For each company, search the web for their phone number, website, and a logistics or operations decision-maker (VP Operations, Director of Supply Chain, VP Logistics, Director of Transportation, or similar title).

Return ONLY a JSON code block in this exact format â€” no other text:

\`\`\`json
{
  "companies": [
    {
      "name": "Exact Company Name",
      "city": "City",
      "state": "${state || "ST"}",
      "zip": "00000",
      "industry": "e.g. Food Manufacturing",
      "product": "What they make or distribute",
      "estimated_revenue": "$45Mâ€“$80M",
      "est_freight_spend": "$1.1Mâ€“$2.4M/yr",
      "shipping_type": "LTL or FTL or Both",
      "bio": "2-3 sentences on what they make, how they ship, and why they are a strong freight prospect.",
      "phone": "Phone number or empty string",
      "website": "URL or empty string",
      "contact_name": "Decision-maker full name or empty string",
      "contact_title": "Their title or empty string",
      "contact_linkedin": "LinkedIn URL or empty string",
      "why_good_prospect": "One sentence: why TLI should call them this week."
    }
  ]
}
\`\`\``;

  lastSearch = {
    state, zip, industry,
    location,
    time: new Date().toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" })
  };

  document.getElementById("promptBox").textContent = currentPrompt;
  document.getElementById("promptBox").style.display = "block";
  document.getElementById("openChatBtn").style.display = "inline-flex";
  document.getElementById("copyBtn").style.display = "inline-flex";
  document.getElementById("promptInstr").style.display = "block";
  document.getElementById("step2num").className = "step-num done";

  // auto-copy
  copyPrompt();
}

function copyPrompt() {
  if (!currentPrompt) return;
  navigator.clipboard.writeText(currentPrompt).then(() => {
    const n = document.getElementById("copyNotice");
    n.classList.add("show");
    setTimeout(() => n.classList.remove("show"), 2200);
  }).catch(() => {
    // fallback
    const ta = document.createElement("textarea");
    ta.value = currentPrompt;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand("copy");
    document.body.removeChild(ta);
  });
}

function openChatGPT() {
  copyPrompt();
  window.open("https://chatgpt.com/", "_blank");
}

// â”€â”€â”€ Parse & render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadResults() {
  const raw = document.getElementById("pasteArea").value.trim();
  const errEl = document.getElementById("parseError");
  errEl.style.display = "none";

  if (!raw) { errEl.textContent = "Nothing pasted yet."; errEl.style.display = "inline"; return; }

  // Try to find JSON
  let jsonStr = "";
  const fenceMatch = raw.match(/```(?:json)?\s*([\s\S]*?)```/i);
  if (fenceMatch) {
    jsonStr = fenceMatch[1].trim();
  } else {
    const s = raw.indexOf("{"), e = raw.lastIndexOf("}");
    if (s !== -1 && e !== -1) jsonStr = raw.slice(s, e + 1);
  }

  if (!jsonStr) {
    errEl.textContent = "Couldn't find JSON. Make sure you copied the full ChatGPT response.";
    errEl.style.display = "inline";
    return;
  }

  let parsed;
  try { parsed = JSON.parse(jsonStr); }
  catch (e) {
    errEl.textContent = "JSON parse error. Try copying the ChatGPT response again from the top.";
    errEl.style.display = "inline";
    return;
  }

  companies = parsed.companies || parsed || [];
  if (!Array.isArray(companies) || companies.length === 0) {
    errEl.textContent = "No companies found in the response. Try generating a new prompt.";
    errEl.style.display = "inline";
    return;
  }

  renderCompanies();
}

function renderCompanies() {
  const container = document.getElementById("cardsContainer");
  container.innerHTML = "";

  companies.forEach((co, idx) => {
    const badge = getBadge(co.shipping_type);
    const initials = (co.name || "?")[0].toUpperCase();
    const websiteDisplay = (co.website || "").replace(/^https?:\/\/(www\.)?/, "").slice(0, 36);
    const websiteHref = co.website
      ? (co.website.startsWith("http") ? co.website : "https://" + co.website)
      : null;

    const card = document.createElement("div");
    card.className = "card";
    card.style.animationDelay = (idx * 55) + "ms";
    card.onclick = () => toggleCard(card);

    card.innerHTML = `
      <div class="card-top">
        <div>
          <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
            <span class="card-name">${esc(co.name)}</span>
            ${badge}
          </div>
          <div class="card-meta">
            <span class="card-loc">ğŸ“ ${esc([co.city, co.state, co.zip].filter(Boolean).join(", "))}</span>
            ${co.industry ? `<span class="card-ind">Â· ${esc(co.industry)}</span>` : ""}
          </div>
        </div>
        <div>
          <div class="card-spend">${esc(co.est_freight_spend || "")}</div>
          <div class="card-spend-lbl">est. freight/yr</div>
        </div>
      </div>

      <p class="card-bio">${esc(co.bio || "")}</p>

      <div class="card-detail">
        <div class="detail-grid">
          ${co.product ? `<div><div class="field-lbl">Product</div><div class="field-val">${esc(co.product)}</div></div>` : ""}
          ${co.estimated_revenue ? `<div><div class="field-lbl">Revenue Est.</div><div class="field-val">${esc(co.estimated_revenue)}</div></div>` : ""}
          ${co.phone ? `<div><div class="field-lbl">Phone</div><div class="field-val">${esc(co.phone)}</div></div>` : ""}
          ${websiteHref ? `<div><div class="field-lbl">Website</div><div class="field-val"><a href="${websiteHref}" target="_blank" rel="noopener" onclick="event.stopPropagation()">${esc(websiteDisplay)}</a></div></div>` : ""}
        </div>

        ${(co.contact_name || co.contact_title) ? `
        <div class="contact-block">
          <div class="contact-avatar">${esc(initials)}</div>
          <div>
            <div class="contact-name">${esc(co.contact_name || "Unknown")}</div>
            <div class="contact-title">${esc(co.contact_title || "")}</div>
            ${co.contact_linkedin ? `<a class="contact-li" href="${esc(co.contact_linkedin)}" target="_blank" rel="noopener" onclick="event.stopPropagation()">LinkedIn â†’</a>` : ""}
          </div>
        </div>` : ""}

        ${co.why_good_prospect ? `
        <div class="why-box">
          <span class="why-label">âš¡ WHY CALL: </span>${esc(co.why_good_prospect)}
        </div>` : ""}
      </div>

      <div class="card-toggle">â–¼ expand details</div>
    `;

    container.appendChild(card);
  });

  // Show results section
  const label = lastSearch.zip
    ? `ZIP ${lastSearch.zip}`
    : (STATE_NAMES[lastSearch.state] || lastSearch.state || "");
  const industryLabel = lastSearch.industry && lastSearch.industry !== "" ? ` Â· ${lastSearch.industry}` : "";

  document.getElementById("resultsCount").textContent = `${companies.length} Prospect${companies.length !== 1 ? "s" : ""} Found`;
  document.getElementById("resultsMeta").textContent = `${label}${industryLabel} Â· ${lastSearch.time || ""}`;
  document.getElementById("exportSub").textContent = `Export all ${companies.length} companies with contacts and bios to Excel`;
  document.getElementById("resultsSection").style.display = "block";
  document.getElementById("emptyState").style.display = "none";
  document.getElementById("exportBtn").style.display = "inline-flex";
  document.getElementById("step3num").className = "step-num done";

  document.getElementById("resultsSection").scrollIntoView({ behavior: "smooth", block: "start" });
}

function toggleCard(card) {
  const bio    = card.querySelector(".card-bio");
  const detail = card.querySelector(".card-detail");
  const toggle = card.querySelector(".card-toggle");
  const open   = detail.classList.contains("open");
  bio.classList.toggle("open", !open);
  detail.classList.toggle("open", !open);
  toggle.textContent = open ? "â–¼ expand details" : "â–² collapse";
}

// â”€â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getBadge(type) {
  const t = (type || "").trim();
  if (t === "LTL")  return `<span class="badge badge-ltl">LTL</span>`;
  if (t === "FTL")  return `<span class="badge badge-ftl">FTL</span>`;
  if (t === "Both") return `<span class="badge badge-both">Both</span>`;
  return `<span class="badge badge-def">${esc(t) || "â€”"}</span>`;
}

function esc(str) {
  if (!str) return "";
  return String(str)
    .replace(/&/g, "&amp;").replace(/</g, "&lt;")
    .replace(/>/g, "&gt;").replace(/"/g, "&quot;");
}

// â”€â”€â”€ Export â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function exportExcel() {
  if (!companies.length) return;

  const rows = companies.map(c => ({
    "Company Name":        c.name        || "",
    "City":                c.city        || "",
    "State":               c.state       || "",
    "ZIP":                 c.zip         || "",
    "Industry":            c.industry    || "",
    "Product / Commodity": c.product     || "",
    "Est. Revenue":        c.estimated_revenue || "",
    "Est. Freight Spend":  c.est_freight_spend || "",
    "Shipping Type":       c.shipping_type || "",
    "Company Bio":         c.bio         || "",
    "Why Good Prospect":   c.why_good_prospect || "",
    "Phone":               c.phone       || "",
    "Website":             c.website     || "",
    "Contact Name":        c.contact_name  || "",
    "Contact Title":       c.contact_title || "",
    "Contact LinkedIn":    c.contact_linkedin || "",
  }));

  const wb = XLSX.utils.book_new();
  const ws = XLSX.utils.json_to_sheet(rows);
  ws["!cols"] = [
    { wch: 34 }, { wch: 18 }, { wch: 6 },  { wch: 10 }, { wch: 26 },
    { wch: 32 }, { wch: 16 }, { wch: 20 }, { wch: 14 }, { wch: 62 },
    { wch: 50 }, { wch: 16 }, { wch: 32 }, { wch: 26 }, { wch: 30 }, { wch: 42 },
  ];

  XLSX.utils.book_append_sheet(wb, ws, "Leads");

  const label = lastSearch.zip ? `ZIP_${lastSearch.zip}` : (lastSearch.state || "ALL");
  XLSX.writeFile(wb, `TLI_Leads_${label}_${new Date().toISOString().slice(0,10)}.xlsx`);
}

// â”€â”€â”€ Clear â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function clearAll() {
  document.getElementById("pasteArea").value = "";
  document.getElementById("parseError").style.display = "none";
  document.getElementById("resultsSection").style.display = "none";
  document.getElementById("emptyState").style.display = "block";
  document.getElementById("exportBtn").style.display = "none";
  companies = [];
}
</script>
</body>
</html>
